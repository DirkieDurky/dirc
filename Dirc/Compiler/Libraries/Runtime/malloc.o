label malloc
mov|i1 16 _ r1 # Go to start of heap
label findFreeLoop
load r1 _ r2
ifNotEq|i2 r2 0 notAvailable
add|i2 r1 1 r1
load r1 _ r2
ifEq|i2 r2 0 allocate
load r1 _ r2
ifMore r2 r0 allocate
label notAvailable
add|i2 r1 1 r1
load r1 _ r2
add r1 r2 r1
add|i2 r1 1 r1
jump findFreeLoop _ pc

label allocate
sub|i2 r1 1 r1
store|i1 1 r1 _
add|i2 r1 1 r1
load r1 _ r2
ifNotEq|i2 r2 0 dontOverride
store r0 r1 _
label dontOverride
add|i2 r1 1 r0
return _ _ _
